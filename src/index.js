import path from 'path';
import Koa from 'koa';
import serve from 'koa-static';
import logger from 'koa-logger';
import compress from 'koa-compress';
import bodyParser from 'koa-bodyparser';
import cors from'koa2-cors';
import router from './router/index'
const app = new Koa();


// app.context.serverAddress = 'https://acc.yonyoucloud.com'
// app.context.serverAddress = 'http://u8cacc-test.yyuap.com'
// app.context.serverAddress = 'http://172.20.52.22'
app.context.iscache = false
app.context.serverAddress = 'https://u8cacc-daily.yyuap.com'//'http://u8cacc-test.yyuap.com'
app.context.cookies = 'JSESSIONID=9F823E45C0B5DBE72BA8FD64CA0C4EDE; locale=zh_CN; PHPSESSID=tpfkfaicj4oegqf44rauu0rur0; ck_safe_chaoke_csrf_token=856e636200b51acdd60dce2b5f95d1b1; at=92875347-1296-4915-96c4-a44d42f96b94; yonyou_uid=8b99f589-bc47-4c3a-bf1c-13d78caa20b0; yonyou_uname=19465888888; yht_access_token=btt4293429f-e37b-4843-ad95-ae7a8f1c4310__1559713959476; wb_at=LMjsvtpjrARfHqt9Cl7ZwtaeeNsbjbZrmnkdwZlokdknqf; yht_token=btt4293429f-e37b-4843-ad95-ae7a8f1c4310__1559713959476; tenantId=qmc9xo0p; userId=8b99f589-bc47-4c3a-bf1c-13d78caa20b0; preTenantId=qmc9xo0p; jwt_token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJkaXdvcmsiLCJzZXNzaW9uIjoie1wiY2xpZW50SXBcIjpcIjEwLjMuNS41MVwiLFwiY3JlYXRlRGF0ZVwiOjE1NTk3MTM5NTksXCJleHRcIjp7XCJvcmdTdGF0dXNcIjpcIm11bHRpXCIsXCJhZG1pblwiOnRydWUsXCJsb2dvXCI6XCJodHRwOi8vY2RuLnlvbnlvdWNsb3VkLmNvbS9kZXYvYXBjZW50ZXIvaW1nL2xvZ28vTE9HTy5wbmdcIixcInlodF9hY2Nlc3NfdG9rZW5cIjpcImJ0dDQyOTM0MjlmLWUzN2ItNDg0My1hZDk1LWFlN2E4ZjFjNDMxMF9fMTU1OTcxMzk1OTQ3NlwifSxcImp3dEV4cFNlY1wiOjYwLFwiand0VmFsaWREYXRlXCI6MTU1OTcxODM5OSxcImxhc3REYXRlXCI6MTU1OTcxODUzOCxcImxvY2FsZVwiOlwiemhfQ05cIixcInByb2R1Y3RMaW5lXCI6XCJ1OGNcIixcInNlc3Npb25FeHBNaW5cIjoyMTYwLFwic2Vzc2lvbklkXCI6XCJMTWpzdnRwanJBUmZIcXQ5Q2w3Wnd0YWVlTnNiamJacm1ua2R3Wmxva2RrbnFmXCIsXCJzb3VyY2VJZFwiOlwiZGl3b3JrXCIsXCJ0ZW5hbnRJZFwiOlwicW1jOXhvMHBcIixcInVzZXJJZFwiOlwiOGI5OWY1ODktYmM0Ny00YzNhLWJmMWMtMTNkNzhjYWEyMGIwXCJ9IiwiZXhwIjoxNTU5NzE4NTk4fQ.uECS2V-oAAoCM1glVFXfE2uCP9IZ9dLaff8EXFlxbBc'
app.context.customSend = {
  '/otp/ficloud_pub/initgrid': {"success":true,"message":"","data":[{"id":"des_action","lable":"目的功能","datatype":0,"length":50,"digit":0,"refinfo":null,"refinfocode":null,"enumdata":null,"hidden":null,"defaultvalue":null,"required":false,"multiple":null},{"id":"effector","lable":"生效条件","datatype":0,"length":2000,"digit":0,"refinfo":null,"refinfocode":null,"enumdata":null,"hidden":null,"defaultvalue":null,"required":false,"multiple":null},{"id":"id","lable":"实体标识","datatype":0,"length":40,"digit":0,"refinfo":null,"refinfocode":null,"enumdata":null,"hidden":null,"defaultvalue":null,"required":false,"multiple":null},{"id":"pk_org","lable":"组织","datatype":5,"length":40,"digit":0,"refinfo":"G001ZM0000BASEDOCORG0000000000000000","refinfocode":"org","enumdata":null,"hidden":null,"defaultvalue":null,"required":false,"multiple":null},{"id":"src_action","lable":"来源功能","datatype":0,"length":50,"digit":0,"refinfo":null,"refinfocode":null,"enumdata":null,"hidden":null,"defaultvalue":null,"required":false,"multiple":null},{"id":"billstate","lable":"目标凭证状态","datatype":6,"length":50,"digit":0,"refinfo":null,"refinfocode":null,"enumdata":[{"temp":"临时"},{"normal":"正式"}],"hidden":null,"defaultvalue":"normal","required":false,"multiple":null},{"id":"code","lable":"编码","datatype":0,"length":50,"digit":0,"refinfo":null,"refinfocode":null,"enumdata":null,"hidden":null,"defaultvalue":null,"required":true,"multiple":null},{"id":"name","lable":"名称","datatype":0,"length":200,"digit":0,"refinfo":null,"refinfocode":null,"enumdata":null,"hidden":null,"defaultvalue":null,"required":true,"multiple":null},{"id":"description","lable":"备注","datatype":0,"length":200,"digit":0,"refinfo":null,"refinfocode":null,"enumdata":null,"hidden":null,"defaultvalue":null,"required":false,"multiple":null},{"id":"src_system","lable":"来源系统","datatype":5,"length":50,"digit":0,"refinfo":"G001ZM0000BASEDOCOUTERSYS00000000001","refinfocode":"outersystem","enumdata":null,"hidden":null,"defaultvalue":null,"required":true,"multiple":null},{"id":"src_billtype","lable":"来源事项类型","datatype":5,"length":50,"digit":0,"refinfo":"G001ZM0000BASEDOCBILLTYPE00000000000","refinfocode":"otp_billtype","enumdata":null,"hidden":null,"defaultvalue":null,"required":true,"multiple":null},{"id":"src_tradetype","lable":"来源交易类型","datatype":5,"length":50,"digit":0,"refinfo":"G001ZM0000BASEDOCTRADETYPE0000000000","refinfocode":"otp_tradetype","enumdata":null,"hidden":null,"defaultvalue":null,"required":false,"multiple":null},{"id":"des_system","lable":"目的系统","datatype":5,"length":50,"digit":0,"refinfo":"G001ZM0000BASEDOCOUTERSYS00000000001","refinfocode":"outersystem","enumdata":null,"hidden":true,"defaultvalue":{"code":"figl","name":"财务云核算服务","id":"A8FD2BE5-E356-4CD3-A6EE-6DA68C72C3AC"},"required":true,"multiple":null},{"id":"des_billtype","lable":"目的事项类型","datatype":5,"length":50,"digit":0,"refinfo":"G001ZM0000BASEDOCBILLTYPE00000000000","refinfocode":"billtype","enumdata":null,"hidden":true,"defaultvalue":{"code":"C0","name":"财务云凭证","id":"G001ZM0000BILLTYPEFIER00000000000002"},"required":true,"multiple":null},{"id":"des_tradetype","lable":"目的交易类型","datatype":5,"length":50,"digit":0,"refinfo":"G001ZM0000BASEDOCTRADETYPE0000000000","refinfocode":"tradetype","enumdata":null,"hidden":true,"defaultvalue":null,"required":false,"multiple":null},{"id":"syncrun","lable":"同步执行","datatype":4,"length":4,"digit":0,"refinfo":null,"refinfocode":null,"enumdata":null,"hidden":true,"defaultvalue":"true","required":false,"multiple":null}],"code":1,"total":0},
  '/opt/ztc': {"name": "zhangtongchuan"},
  '/otp/func/funcs': {"success":true,"message":"操作成功。","data":[{"code":"GLAccountBalance","name":"总账科目余额","description":"1234567890","id":"1c696c8c-72cf-11e9-b2c6-0673980005d7"},{"code":"GLAccountAmount","name":"总账科目发生额","description":"1234567890","id":"1c697593-72cf-11e9-b2c6-0673980005d7"}],"code":1,"total":0},
  '/ficloud/auxdetail/queryaux': {"success":true,"message":"操作成功。","data":[{"code":"0001","name":"部门","auxtype":"dept"},{"code":"0002","name":"项目","auxtype":"project"},{"code":"0003","name":"人员","auxtype":"personnel"},{"code":"0004","name":"供应商","auxtype":"supplier"},{"code":"0005","name":"客户","auxtype":"customer"},{"code":"0006","name":"组织现金账户","auxtype":"org_fin_cashacct"},{"code":"0007","name":"组织银行账户","auxtype":"finorgbankacct"},{"code":"0008","name":"费用项目","auxtype":"feeitem"},{"code":"0009","name":"物料分类","auxtype":"materialclass"}],"code":1,"total":0},
  '/otp/func/param': {"success":true,"message":"操作成功。","data":[{"code":"fetchtype","datatype":6,"values":[{"code":"initbalance","name":"期初余额"},{"code":"finalbalance","name":"期末余额"},{"code":"accrual","name":"发生额"}],"name":"取数类型","multiple":false,"id":"1c69ea5c-72cf-11e9-b2c6-0673980005d7","required":true},{"code":"accbook","datatype":5,"name":"账簿","multiple":false,"id":"1c6a1c83-72cf-11e9-b2c6-0673980005d7","required":true},{"code":"accproperty","datatype":5,"name":"会计要素","multiple":false,"id":"1c6a224e-72cf-11e9-b2c6-0673980005d7","required":false},{"code":"accsubject","datatype":0,"name":"会计科目","multiple":null,"id":"1c6a2450-72cf-11e9-b2c6-0673980005d7","required":false},{"code":"auxiliary","datatype":41,"name":"辅助核算","multiple":false,"id":"1c6a2633-72cf-11e9-b2c6-0673980005d7","required":false},{"code":"currency","datatype":5,"name":"币种","multiple":false,"id":"1c6a2837-72cf-11e9-b2c6-0673980005d7","required":true},{"code":"retbaltype","datatype":6,"values":[{"code":"standardcurrencybalance","name":"本位币"},{"code":"originalcurrencybalance","name":"原币"}],"name":"返回余额类型","multiple":false,"id":"1c6a2ce1-72cf-11e9-b2c6-0673980005d7","required":true},{"code":"periodtype","datatype":6,"values":[{"code":"year","name":"年"},{"code":"season","name":"季"},{"code":"month","name":"月"}],"name":"期间类别","multiple":false,"id":"1c6a3048-72cf-11e9-b2c6-0673980005d7","required":true},{"code":"period","datatype":0,"name":"期间","multiple":false,"id":"1c6a31c1-72cf-11e9-b2c6-0673980005d7","required":true},{"code":"direction","datatype":6,"values":[{"code":"credit","name":"贷方"},{"code":"debit","name":"借方"}],"name":"方向","multiple":false,"id":"1c6a3331-72cf-11e9-b2c6-0673980005d7","required":true},{"code":"nottally","datatype":4,"name":"包含未记账","multiple":false,"id":"1c6a3489-72cf-11e9-b2c6-0673980005d7","required":true},{"code":"accbody","datatype":5,"name":"利润中心","multiple":true,"id":"1c6a2012-72cf-11e9-b2c6-0673980005d7","required":false}],"code":1,"total":0},
  // '/ficloud/refbase_ctr/queryRefJSON': {"success":true,"message":null,"data":[{"code":"ceshi002","name":"财务测试总公司_报告账簿","id":"00438202-0341-4A18-83CA-6F1ED86D10A9"},{"code":"总账-下级组织-报告账簿","name":"总账-下级组织-报告账簿","id":"0E77C5D6-D37D-4FDE-98ED-41620B36F862"},{"code":"zbl0516zb","name":"zbl0516zb","id":"1B4739C1-417F-4096-A9EF-4B666BE03757"},{"code":"tkgs01_0001","name":"天开公司","id":"1cf1e0957c3a11e9b2c60673980005d7"},{"code":"23","name":"sg","id":"35044743-05DB-4DDA-8058-8E5944A93CAE"},{"code":"0517-FI_0001","name":"0517财务","id":"39014030787111e9b2c60673980005d7"},{"code":"123","name":"123","id":"390B916E-061E-4A6A-A8D5-D7F6A67BFE18"},{"code":"9996","name":"财务测试总公司","id":"597E6687-25FD-4CF6-81CC-7D16A6A6618C"},{"code":"GDZC001","name":"固定资产测试公司01","id":"6D9B128E-8EC2-482E-A013-6AD9DB6B8B4F"},{"code":"GDZC002","name":"固定资产测试公司02","id":"71D5F0A4-FAC6-4E20-B23D-F58F32A5357F"},{"code":"erew","name":"erew","id":"7B849C6F-68D2-446A-BCB9-450A9F54BA0F"},{"code":"zz-下级_0001","name":"总账-下级组织","id":"8d76ac41787011e9b2c60673980005d7"},{"code":"jz01_0001","name":"玲珑公司","id":"a26b04897b8e11e9b2c60673980005d7"},{"code":"sbq001","name":"sbq001","id":"AB0E30C3-E014-48A8-8ED5-9F677E4EA28E"},{"code":"zL1_0001","name":"天美公司","id":"ac5e62d87abb11e9b2c60673980005d7"},{"code":"SGzb01","name":"SG账簿名称","id":"B87158B3-5F8C-4AA5-B02E-FCFF893B07B6"},{"code":"STtest001_0001","name":"S Test Company","id":"ba006fba7b7211e9b2c60673980005d7"},{"code":"test","name":"test","id":"C6722E3C-3ABB-4D3F-BB74-B4B7D562AF6F"},{"code":"fi0518","name":"fi0518","id":"D42C8780-CF14-45FB-AB98-737AAC5D3305"},{"code":"0020","name":"测试新增","id":"D8495B3B-4BBE-457A-BBA3-3584F2440B84"},{"code":"test001_0001","name":"自动化测试总公司","id":"dacb39af804911e9b2c60673980005d7"},{"code":"ttgs_0001","name":"福泽公司","id":"e67f51437bbe11e9b2c60673980005d7"},{"code":"zj01","name":"zj01","id":"F192ED83-8717-4677-8EC2-426723B9599A"},{"code":"0520001_0001","name":"0520001公司","id":"fe167b2a7a9911e9b2c60673980005d7"}],"code":0,"total":0}
  // '/ficloud/vt/vtlist':{"success":true,"message":"操作成功。","data":[{"header":{"id":"ED99C325-C052-4BC5-A16D-D2AB3EEB346D","creator":{"id":"8b99f589-bc47-4c3a-bf1c-13d78caa20b0","code":"YHT-978-5121559358384592","name":"19465888888"},"creationtime":"2019-06-05 14:41:36","modifier":null,"modifiedtime":null,"pk_org":null,"pk_group":null,"description":null,"ts":"2019-06-05 14:41:36","dr":0,"state":0,"code":"111","name":"111","name2":"111","name3":"111","name4":"111","name5":"111","name6":"111","accbook":{"id":"63cb658885a011e9b2c60673980005d7","code":"ZZCS_0001","name":"总账测试"},"accsubjectchart":null,"periodtype":"Month","category":"Normal","terminal":false,"settlestrategy":"NONE","vouchertype":{"id":"3f0789fb-84e1-11e9-b2c6-0673980005d7","code":"1","name":"记账凭证"},"accbody":null,"effectperiod":null,"expiryperiod":null,"tenantid":"qmc9xo0p","srctplid":null},"body":[{"id":"A974B32A-EC38-4F22-9C90-BD5F6927A5D3","tenantid":"qmc9xo0p","srctplid":null,"accsubjectfun":null,"accsubjectdesc":"1121 应收票据","currency":{"id":"G001ZM0000DEFAULTCURRENCT00000000001","code":"CNY","name":"人民币"},"debit_originalfun":"11","credit_originalfun":null,"description":"支付工资","description2":"","description3":"","description4":"","description5":"","description6":"","clientauxiliary":[{}]},{"id":"FBD0B7CC-E153-49A1-A9B4-4F9C052312D1","tenantid":"qmc9xo0p","srctplid":null,"accsubjectfun":null,"accsubjectdesc":"1122 应收账款","currency":{"id":"G001ZM0000DEFAULTCURRENCT00000000001","code":"CNY","name":"人民币"},"debit_originalfun":null,"credit_originalfun":"11","description":"支付工资","description2":"","description3":"","description4":"","description5":"","description6":"","clientauxiliary":[{}]}]},{"header":{"id":"421CE3A5-9435-4B36-A25F-F1F3C44F3A0B","creator":{"id":"8b99f589-bc47-4c3a-bf1c-13d78caa20b0","code":"YHT-978-5121559358384592","name":"19465888888"},"creationtime":"2019-06-05 14:43:53","modifier":null,"modifiedtime":null,"pk_org":null,"pk_group":null,"description":"","ts":"2019-06-05 14:43:53","dr":0,"state":0,"code":"77","name":"77","name2":"","name3":"","name4":"","name5":"","name6":"","accbook":{"id":"63cb658885a011e9b2c60673980005d7","code":"ZZCS_0001","name":"总账测试"},"accsubjectchart":null,"periodtype":"Year","category":"Frame","terminal":false,"settlestrategy":"NONE","vouchertype":null,"accbody":null,"effectperiod":null,"expiryperiod":null,"tenantid":"qmc9xo0p","srctplid":null},"body":[{"id":"94A2A79E-B457-455D-9BF7-B16BC6B4B133","tenantid":"qmc9xo0p","srctplid":null,"accsubjectfun":null,"accsubjectdesc":"1001 库存现金","currency":{"id":"G001ZM0000DEFAULTCURRENCT00000000001","code":"CNY","name":"人民币"},"debit_originalfun":"8","credit_originalfun":"","description":"","description2":"","description3":"","description4":"","description5":"","description6":"","clientauxiliary":null}]}],"code":1,"total":0}
}

app.use(logger())
	.use(cors({
		origin: function(ctx){
			return ctx.header.origin //"http://localhost:4001";
		},
		exposeHeaders: ['WWW-Authenticate', 'Server-Authorization'],
	    maxAge: 5,
	    credentials: true,
	    allowMethods: ['GET', 'POST', 'DELETE'],
	    allowHeaders: ['Content-Type', 'Authorization', 'Accept']
	}))
	.use(bodyParser())
  .use(compress())
  // .use(async function(ctx,next){
  //   console.log([ctx.request.url,JSON.stringify(ctx.header)]);
  //   next();
  // })
  .use(router.routes())
  .use(router.allowedMethods())
  .use(serve(path.join(process.cwd(), 'static')))

app.listen(3333)
console.log('listening on port 3333');